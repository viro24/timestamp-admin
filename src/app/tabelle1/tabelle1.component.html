<div class="container">
  <div class="navigation">
    <button mat-raised-button disabled>Übersichtstabelle</button>
    <button mat-raised-button (click)="handleClickNavi2()">
      Kontenübersicht
    </button>
    <button mat-raised-button (click)="handleClickNavi3()">
      Tabellen basierte Auswertung
    </button>
  </div>
  <div class="content">
    <div class="content-title">
      <span class="title"><h2>Übersichtstabelle mit Korrekturfunktion</h2></span
      ><span
        class="substitle"
        [style]="{ visibility: showRange ? 'visible' : 'hidden' }"
        >für den Zeitraum {{ this.dateStart | date: "shortDate" }} bis
        {{ this.dateEnd | date: "shortDate" }}</span
      >
    </div>
    <div class="content-header">
      <mat-form-field class="name">
        <mat-label>Mitarbeitername</mat-label>
        <mat-select [(ngModel)]="currentEmployeeId">
          <mat-option *ngFor="let e of employees" [value]="e.employeeId">
            {{ e.firstName }} {{ e.lastName }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <mat-form-field class="date">
        <mat-label>Startdate</mat-label>
        <input matInput [matDatepicker]="picker1" [(ngModel)]="dateStart" />
        <mat-datepicker-toggle
          matSuffix
          [for]="picker1"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="date">
        <mat-label>Enddate</mat-label>
        <input matInput [matDatepicker]="picker2" [(ngModel)]="dateEnd" />
        <mat-datepicker-toggle
          matSuffix
          [for]="picker2"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
      </mat-form-field>
      <button mat-raised-button (click)="handleClickFilter()">Filter</button>
    </div>
    <div class="content-content">
      <!-- <treetable [tree]="treeData"></treetable> -->
      <table mat-table [dataSource]="bookingData">
        <ng-container matColumnDef="datum">
          <th mat-header-cell *matHeaderCellDef>Datum</th>
          <td mat-cell *matCellDef="let book" (click)="handleOpenCell()">
            {{ book.dateOfDetails | date: "EE" }}
            {{ book.dateOfDetails | date: "shortDate" }}
            <mat-card *ngIf="open">
              <mat-list *ngFor="let b of book.bookingsList">
                <mat-list-item>
                  Buchung {{ book.bookingsList.indexOf(b) + 1 }}
                  {{ b.period.start | date: "HH:mm" }} -
                  {{ b.period.end | date: "HH:mm" }}
                  <div *ngIf="b.breakList">
                    <mat-list *ngFor="let p of b.breakList">
                      <mat-list-item>
                        Pause {{ b.indexOf(p) }}
                        {{ p.period.start | date: "HH:mm" }} -
                        {{ p.period.end | date: "HH:mm" }}
                      </mat-list-item>
                      <mat-list-item>Pause 1 : 10:00 - 10-15</mat-list-item>
                      <mat-list-item>Pause 1 : 10:00 - 10-15</mat-list-item>
                      <mat-list-item>Pause 1 : 10:00 - 10-15</mat-list-item>
                    </mat-list>
                  </div>
                </mat-list-item>
              </mat-list>
            </mat-card>
          </td>
        </ng-container>

        <ng-container matColumnDef="start">
          <th mat-header-cell *matHeaderCellDef>Start</th>
          <td mat-cell *matCellDef="let book">
            {{ book.bookingsList[0].period.start | date: "HH:mm" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="end">
          <th mat-header-cell *matHeaderCellDef>End</th>
          <td mat-cell *matCellDef="let book">
            <span *ngIf="book.bookingsList">{{
              book.bookingsList[book.bookingsList.length - 1].period.end
                | date: "HH:mm"
            }}</span>
            <ul #books [hidden]="true">
              <li *ngFor="let b of book.bookingsList">
                {{ b.period.end | date: "HH:mm" }}
              </li>
            </ul>
          </td>
        </ng-container>
        <ng-container matColumnDef="istAZ">
          <th mat-header-cell *matHeaderCellDef>Ist AZ</th>
          <td mat-cell *matCellDef="let book">
            {{ dateFormat(book.dailyBookingTimeInMillisReal) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="sollAZ">
          <th mat-header-cell *matHeaderCellDef>Soll AZ</th>
          <td mat-cell *matCellDef="let book">
            {{ dateFormat(book.targetWorkingTimeInMillis) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="istPause">
          <th mat-header-cell *matHeaderCellDef>Ist Pause</th>
          <td mat-cell *matCellDef="let book">
            {{ dateFormat(book.dailyBreakTimeInMillisReal) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="sollPause">
          <th mat-header-cell *matHeaderCellDef>Soll Pause</th>
          <td mat-cell *matCellDef="let book">
            {{ dateFormat(book.dailyBreakTimeInMillisEffective) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="ueberstunde">
          <th mat-headcell *matHeaderCellDef>Überstunden</th>
          <td mat-cell *matCellDef="let book">
            {{ dateFormat(book.overtimeInMillis) }}
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
        <tr mat-row *matRowDef="let myRowData; columns: displayColumns"></tr>
      </table>
    </div>
  </div>
</div>
{{ bookingData | json }}
